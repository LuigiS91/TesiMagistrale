\chapter{Introduzione}
La necessità di avere dei velivoli a pilotaggio remoto nasce inizialmente per scopi militari. Il primo velivolo radiocomandato fu infatti in De Haviland 82, adattato per l'addestramento della contraerea con un sistema di pilotaggio remoto attraverso radiocomando \cite{histoDrone}. \'E invece alla sperimentazione riguardante il mondo elicotteristico che si deve la comparsa delle prime configurazioni di quadricottero, un esempio il Jerome-de Bothezat Flying Octopus, velivolo costruito da George de Bothezat nel 1922 \cite{Young}. Ai tempi però questi tipi di configurazione avendo caratteristiche di controllabilità molto carenti e non riuscendo a soddisfare le caratteristiche di peso strutturale e potenze dei motori necessarie non permisero un successivo sviluppo a vantaggio delle configurazioni degli elicotteri così come la conosciamo adesso. Con il successivo avvento della modellistica negli anni '60, lo sviluppo di nuove tecnologie elettroniche e dei materiali, con relativo abbattimento dei costi, si sono potute superare le limitazioni del passato aprendo agli scenari applicativi più svariati oltre a quelli bellici, amatoriali e industriali. Nacquero quindi i primi modelli di droni commerciali.

Attualmente si parla in modo generico di multicottero, comprendendo in questa categoria molteplici configurazioni, tra le quali si è affermata maggiormente grazie alla versatilità e semplicità applicativa quella del quadricottero, configurazione utilizzata anche in questa tesi. Il funzionamento è basato sulla presenza di quattro rotori che generano il sostentamento producendo portanza dalla rotazione. Questi sono disposti in modo che sia anche possibile attraverso l'azionamento differenziale il controllo sul velivolo su tutti quanti i gradi di libertà, principalmente l'assetto e secondariamente a questa la posizione. I rotori sono installati su di una base rigida nella quale oltre al payload sono presenti un sistema di controllo necessario a stabilizzare e comandare il velivolo, i sensori necessari per la determinazione dello stato del velivolo e le interfacce in radiofrequenza per la trasmissione del radio comando e di messaggi più complessi per la navigazione e la telemetria. \'E proprio grazie alla presenza di questi avanzati moduli elettronici miniaturizzati ed estremamente integrati che è stato reso possibile l'utilizzo dei multicotteri altrimenti instabili e ingovernabili \cite{multi2015}. Il sistema infatti è caratterizzato dall'essere un sistema estremamente non lineare con dinamiche accoppiate. Inoltre, avendo in questo caso solo quattro attuazioni, esso risulta essere sottoattuato: meno controlli rispetto ai gradi di libertà \cite{nonlinear2008}.

Vengono riportati i principali vantaggi e svantaggi di questi sistemi \cite{DesTestCarm},\cite{irisquad}.
\paragraph{Vantaggi}
\begin{itemize}
	\item Capacità di mantenere una posizione nello spazio fissa e di decollare verticalmente.
	\item Grande manovrabilità. Il velivolo è in grado di cambiare repentinamente il proprio assetto e la propria velocità.
	\item Sistema molto semplice da costruire e mantenere.
\end{itemize}
\paragraph{Svantaggi}
\begin{itemize}
	\item La durata della batteria è limitata. Risulta limitata l'autonomia di volo.
	\item Il sistema è sottoattuato e non lineare. Questo si traduce in una difficoltà nel essere controllato.
	\item Il payload imbarcabile è relativamente basso.
\end{itemize}

Un aspetto importate da considerare è la presenza dei sensori, senza di questi non sarebbe possibile ricavare attraverso filtraggio e stima, lo stato del velivolo e quindi determinare il controllo da attuare per ottenere la risposta, in termini di posizione e velocità o traiettoria desiderata. I tipici sensori installati sono quelli che permettono la determinazione delle accelerazioni sui tre assi e angolari. Teoricamente queste sei misure se integrate sarebbero sufficienti, ma a causa della intrinseca presenza di rumore ed errori non del tutto eliminabili, si adoperano ulteriori sensori. L'antenna di ricezione del Sistema di posizionamento globale (GPS), un altimetro barometrico e magnetometri, possono compensare i difetti di misurazione, attraverso filtraggio e composizione delle misure \cite{KoksalN2018ALQA}. Nell'applicazione specifica trattata in questa tesi il segnale GPS non è da considerarsi affidabile in quanto, viene ripreso in parte il lavoro di ricerca svolto al Politecnico di Torino \cite{DesTestCarm}, \cite{baseTesi}, ovvero l'uso per applicazioni indoor.



\begin{commento}
citare Development of Hardware-in-the-Loop Simulation Based on Gazebo
	and Pixhawk for Unmanned Aerial Vehicles : assenza di simulink
citare il lavoro di Davide
citare la tesi naval con luso di simulink
citare Implementation of Sliding Mode Fault Tolerant Control on the IRIS+
Quadrotor
\end{commento}

\begin{idee}
%\cite{KimJinho2020ACSo} : In questo pubblicazione vengono riassunti vari tipi di controllori che sono stati utilizzati in diverse pubblicazioni. trattato in dettaglio nel capitolo

%\cite{KoksalN2018ALQA} : Necessità di fusione dei sensori per avere una stima corretta del posizionamento del drone nello spazio, in più viene usato un controllore LQR . Qui si fa un test di volo direttamente, che cosa hanno capito?
%
%In questa pubblicazione hanno ottenuto la garanzia di stabilità controllabilità applicando un controllo ottimale.
%Hanno tenuto conto del rumore, confrontando due tipi di filtraggio dei dati dei sensori : Kalman filtro complementare. Il loro scopo era ottimizzare il consumo di batteria attraverso il design ottimale del controllore e path planner. Viene suddiviso il controllo in due livello : alto livello,guidance e posizione; secondo livello attitude e altidue , maggiore interesse in questo . Concentrazione. Due voli sperimentali molto semplici. Drone specifico protetto da struttura di posizione. Io Voglio poterlo fare a rpescindere, cambiare drone.

%\cite{ZuluAndrew2014ARoC} : Trade-off tra diversi sistemi di controllo usati in varie pubblicazioni.


%\cite{CrazyS} :  Qui si motiva iperchè usare SIL. In questo articolo viene proposto CrasyS una estensione di ROS per modellare , sviluppare e integrare il Quadricottero Crazy flight 2.0 nano nella simulazione basata su Gazebo. Il controllore usa due PID e un generatore del segnale di riferimento. Per validare il sistema viene usato Il toolbox  di MAthWorks Robotics System che collega matlab e simulink a gazebo attraverso messaggi asincroni
%
%Il problema nasce dalla difficoltà di fare volare autonomamente il drone in modo autonomo in contesti particolari come quelli indoor, dove possono verificarsi condizioni imprevedibili.Situazioni critiche. Studiare missioni complesse subito nel mondo reale può essere complicato e richiedere moloto tempo invece la simulazione è molto più semplice, e costare nulla in termini di costi e sicurezza. Si può far schiantare il drone quante volte si vuole. In questo modo dalle simulazioni è possibile testare il sistema in varie condizioni. L'ambiente simulativo è molto versatile e si possono espandere le funzionalità in modo da poter avere più test possibili.

%\cite{SIL_design} : Progetto di un sistema di controllo di altitudine sviluppato attraverso le simulazioni fatte in software in the loop. Questo approccio ha permesso di descrivere un procedura di test basati su modelli fisici del sistema. Viene usato una procedura detta chiusura del loop successiva. Il collegamento e lo scambio dei dati con i sensori emulati avviene attraverso protocollo MAVLink. Viene utilizzato DRONEkit e attraverso le sue API, per rendere più facili la generazione di codice del computer compagno con firmware Ardupilot.

%\cite{toolPx4} : in questa presentazione del tool di matlab viene presentata la procedura di generazione del codice danda risalto alla necessità di effettuare la validazione seguendo l'approccio model-base. Viene Espressa l'implementazione specifica utilizzando il controllore ixHawk con sistema PX4 . Specificando quale parte del codice viene generato e come questo viene implementato all'interno del firmware dell'hardware. Vengono trttate le funzionalitò del Tool. Viene però usato jMavsim.

%\cite{HIL_Dev} : in questa pubblicazione si sviluppa un software per testare l'effettiva comunicazione tra le varie parti del sistema per fare HIL in modo sicuro. viene usato Gazebo pixHawk . Viene sviluppato CAS Control application Software. Viene enfatizzata anche qui la necessità di simulare prima di effettuare test di volo. Riduce il rishio di rompere il sistema, a causa si cadute , fallimenti del sistema malfunzionamento del cotnrollore. Si fa riferimento alla poca versatilità di implementazione di modelli matematici di jmavsim. Gli altri simulatori son molto difficili da modificare in termini di aggiunta di diversi tipi di sensori, per questo si sceglia Gazebo. Gazebo è molto usato in robotica.Prensenta anche la capacità di risolvere la dinamica con il suo motore fisico open Dynamic Engine (ODE), conm grande accuratezza.
%
%\cite{SIL_perform} : In questo lavoro di evidenzia come sia necessario fare SITL. Viene utilizzato il SITL per valutare le performance del sistema di guida e controllo di un UAV, utilizzando un filtro di kalman per stimare lo stato del velivolo e un controllo formato da PID
%
%\cite{SIL_Improv} : Questa pubblicazione parla eslicitamente perchè è importate fare SITL. Viene mostrato come alcune criticità della SITL non siano mostrate il MIL. Nele simulazioni vengono considerate missioni complesse. Si fa riferimento esplicito al V-model. Il controllo usato è di tipo PD. In questo lavoro si utilizza ROS con pacchetto RotorS, implementato in Gazebo. Mentre la soluzione è accettabile in MIL, non lo è in SIL, instabilità del controllo.

%\cite{Vision_base} : In questo lavoro viene usato PX4 e si fa SITL, utilizzando Gazebo. In Gazebo viene aggiunto un sensore visivo per fare delle simulazioni avanzate sfruttando questa funzionalità.

%\cite{SIL_obstacle} : viene validato il sensore LIDAR e la capacità di separazione dagli ostacoli utilizzando un computer di bordo PixHawk , usando un modello simulativo su gazebo in condizioni realistiche. 


%\cite{iso26262} : nella Normativa si fa riferimento alla funcrional Safety. Deriva dalla IEC 61508 standard nel settore specifico elettronico.
%Si utilizza il modello a V : Software integration and verification Software unit verification. 
%
%Facendo software in the loop si possono simulare condizioni pericolose che in un test sperimentale non è possibile fare.
%Si possono verificare i comportamenti in caso di guasti ed errori voluti in fase di simulazione.


\end{idee}




%\begin{idee}
%	Durante la SIT è possibili introdurre fault arbitrari ai fini di testare i meccanismi di sicurezza , simulando la rottura di componenti software e hardware. Il più è possibile valutare sulle macchine target alcuni aspetti di utilizzo delle risorse, questo consente di aumentare la funtional safety del prodotto. In più si può fare back to back comparazione tra modello e codice, garantendo la robustezza del risultato.
%\end{idee}

Nel settore industriare risulta ormai affermata la pratica di progettazione model-based, più precisamente in questo lavoro di tesi si fa riferimento alla fase di generazione del codice, di test e validazione dei componenti software. Prendendo ad esempio il settore automotive, si può parlare standard di qualità \cite{iso26262}, in questi è presente la "Software Integration and Unit Verification" come tassello chiave dello sviluppo di software da implementare in dispositivi hardware, seguiti da tutti i documenti redatti per una corretta tranciabilità necessaria ad uno sviluppo coerente e professionale. \'E evidente la necessità di prendere spunto nello sviluppo di questi tipi di prodotto alle pratiche industriali, in modo da soddisfare diversi criteri come la sicurezza nelle varie condizioni operative. Nella fase di test preliminare del software si possono introdurre situazioni complesse \cite{MIL_Auto}, le quali richiederebbero uno sforzo in termini di tempo e denaro non facilmente affrontabili se non addirittura irrealizzabili. Questo approccio rende anche possibile analizzare il comportamento in caso di guasto del sistema hardware, oltre che alla validazione della compatibilità stessa tra il software e l'hardware utilizzato, non sempre in questo campo sviluppato in modo parallelo.
Non è infatti affatto scontato che si riescano ad evidenziare criticità con il solo ausilio delle simulazioni MIL, come si osserva nello studio \cite{SIL_Improv}. In questo documento viene mostrato come la criticità del sistema di controllo si presenti solo nella simulazione SIL. Applicando il V-model nello sviluppo è stato implementato un controllore Proportional-Derivative (PD) e si è simulato il comportamento attraverso una simulazione MIL, successivamente utilizzando le funzionalità del sistema Robotic Operating System (ROS) e il pacchetto RotorS, è stato utilizzando Gazebo. Nella simulazione SIL è stato aumentando anche il livello di dettaglio del modello del quadricottero e dei sensori utilizzati. Effettuando così la simulazione SIL si è osservato la presenza di instabilità nella risposta, non presente nella simulazione MIL.
Uno studio simile è stato pubblicato in \cite{CrazyS}, nella quale oltre all'utilizzo di Gazebo e ROS è stato utilizzato la code-generation messa a disposizione del toolbox di MATLAB "Mathwork Robotics System", rendendo possibile lo sviluppo del controllo utilizando MATLAB e Simulink. Il controllore implementato in questa soluzione è un PID. In questo studio il drone ha uno scopo di applicazione indoor, come nel lavoro di questa tesi.
Dall'esigenza di testare l'efficacia dei software creati in \cite{SIL_perform}, viene mostrato la fase di test attraverso SIL della capacità di filtraggio implementata a livello di software di un filtro di Kalman per stimare lo stato del velivolo e le capacità di controllo attraverso PID. Un altra simulazione SIL viene nella pubblicazione \cite{SIL_design}, dove viene progettato un sistema di controllo di altitudine utilizzando le API di DRONEkit per la generazione del codice e attraverso protocollo MAVLINK vengono collegati i segnali emulati dei sensori.
Il vantaggio di usare Gazebo come simulatore si apprezza molto nello studio pubblicato nel documento \cite{Vision_base}. In questo lavoro infatti si implementa nella simulazione un modulo visivo, che rende quindi il drone capace di osservare il mondo in cui sta operando. La capacità di osservare aggiunge al sistema la possibilità di poter evitare gli ostacoli, aspetto critico in applicazioni indoor, nella quale le distante con gli oggetti si riducono. NElla pubblicazione \cite{SIL_obstacle} infatti si valida, attraverso una simulazione SIL, l'utilizzo di un sensore Laser Imaging Detection and Ranging (LIDAR), che permette una precisa identificazione e la misurazione della distanza degli oggetti presenti, rendendo disponibile informazioni molto utili agli algoritmi di separazione dagli ostacoli.
Successiva alle simulazioni SIL occorre, come accennato precedentemente, testare il software installato sull'hardware specifico attraverso simulazioni HIL. Per questo obbiettivo in \cite{HIL_Dev} viene presentato un software denominato Control Application Software (CAS). CAS ha lo scopo di gestire i messaggi a livello centralizzato tra i vari elementi fisici che compongono la simulazione HIL, ovvero tra l'hardware dell'autopilota, il simulatore e il software utilizzato nella stazione di terra, in questo caso QGroudControl. L'hardware utilizzato nello studio e un PixHawk con relativo firmware PX4, testato utilizzando un simulatore implementato in Gazebo.

Seguendo la filosofia del V-model in questa tesi viene mostrata l'implementazione del controllo di un autopilota utilizzando MATLAB/Simulink con l'ausilio del tool "Embedded Coder Support Packagefor PX4 Autopilots" \cite{toolPx4}, che permette di generare il codice utilizzando le funzionalità già presenti in PX4 per un sistema hardware che utilizzato, nello specifico per questa tesi l'autopilota PixHawk. Le simulazioni SIL vengono effettuate utilizzando Gazebo, nella quale è presente il motore fisico Open Dynamic Engine, molto affidabile e robusto per la soluzione delle equazioni differenziali della dinamica del corpo rigido. Vengono utilizzati i moduli presenti nella cartella di sviluppo del firmware PX4 \cite{px4Firmware}, opportunamente modificati. Nello specifico vengono mostrati due differenti modelli di controllo utilizzando un controllo PID modificato per la gestione della posizione e rispettivamente un due controlli PID e SMC per la gestione della quota e dell'assetto che vengono mostrati nel dettaglio all'interno del capitolo relativo alle simulazioni. Queste simulazioni hanno quindi l'obbiettivo di validare gli algoritmi di controllo seguendo alcuni approcci tipici del paradigma model-based derivati dai settori più avanzati.


\section{Organigramma della tesi}
La tesi è suddivisa, oltre a questo capitolo introduttivo, in tre capitoli:
\begin{itemize}
	\item \textbf{Sistema Quadrirotore:} In questo capitolo verrà trattato nel dettaglio il sistema quadrirotore. Nello specifico verranno considerati il modello matematico, le leggi di controllo adottate e gli algoritmi di guida.
	\item \textbf{Descrizione Autopilota :} Verranno trattati i dettagli del sistema scelto per l'implementazione. Varranno descritti in questo capitolo i dettagli del drone, l'autopilota scelto con il corrispettivo firmware e gli strumenti messi a disposizione per i test, con le modifiche effettuate.
	\item \textbf{Simulazioni : } In questo ultimo capitolo verranno messi a confronto attraverso le simulazioni due differenti sistemi di controllo e le conclusioni. L'ultima parte del capitolo riguarderà il lavoro svolto sulle simulazioni PIL e i problemi riscontrati e possibili studi futuri.
\end{itemize}