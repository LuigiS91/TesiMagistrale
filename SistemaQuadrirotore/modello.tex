\section{Modello matematico}

\subsection{Gazebo}

\lstset{language=c++}
\begin{lstlisting}
//gazebo_motor_model.cpp

...

//Leggo i parametri dal file di impostazione

getSdfParam<double>(_sdf, "ForceQuadraticCoefficent", force_quadratic_coefficent_, force_quadratic_coefficent_);
getSdfParam<double>(_sdf, "ForceLinearCoefficent", force_linear_coefficent_, force_linear_coefficent_);
getSdfParam<double>(_sdf, "ForceCostant", force_costant_, force_costant_);
getSdfParam<double>(_sdf, "ForceMinRpmFitting", force_min_rpm_fitting_, force_min_rpm_fitting_);

getSdfParam<double>(_sdf, "MomentQuadraticCoefficent", moment_quadratic_coefficent_, moment_quadratic_coefficent_);
getSdfParam<double>(_sdf, "MomentLinearCoefficent", moment_linear_coefficent_, moment_linear_coefficent_);
getSdfParam<double>(_sdf, "MomentCostant", moment_costant_, moment_costant_);
getSdfParam<double>(_sdf, "MomentMinRpmFitting", moment_min_rpm_fitting_, moment_min_rpm_fitting_);

...

//Aggiungo modifica forma quadratica
double force = std::isgreater(std::abs(real_motor_velocity),force_min_rpm_fitting_)*
(real_motor_velocity * real_motor_velocity * force_quadratic_coefficent_ 
+ std::abs(real_motor_velocity)* force_linear_coefficent_ + force_costant_);
if (force<0) force=0;

link_->AddRelativeForce(ignition::math::Vector3d(0, 0, force));

ignition::math::Vector3d drag_torque(0, 0, -turning_direction_ *
std::isgreater(std::abs(real_motor_velocity),
moment_min_rpm_fitting_)*(real_motor_velocity * 
real_motor_velocity * moment_quadratic_coefficent_ + 
std::abs(real_motor_velocity) * moment_linear_coefficent_+ moment_costant_));

...

ignition::math::Vector3d drag_torque_parent_frame = pose_difference.Rot().RotateVector(drag_torque);
parent_links.at(0)->AddRelativeTorque(drag_torque_parent_frame);

...

\end{lstlisting}

\lstset{language=XML}
\begin{lstlisting}
<!-- drone.sdf-->

...

<plugin name='front_left_motor_model' filename='libgazebo_motor_model.so'>
<robotNamespace/>
<jointName>rotor_3_joint</jointName>
<linkName>rotor_3</linkName>
<turningDirection>cw</turningDirection>
<maxRotVelocity>2000</maxRotVelocity>
<commandSubTopic>/gazebo/command/motor_speed</commandSubTopic>
<motorNumber>3</motorNumber>
<motorSpeedPubTopic>/motor_speed/3</motorSpeedPubTopic>
<rotorVelocitySlowdownSim>10</rotorVelocitySlowdownSim>
<ForceQuadraticCoefficent>1.1632e-5</ForceQuadraticCoefficent>
<ForceLinearCoefficent>-0.0202</ForceLinearCoefficent>
<ForceCostant>8.1513</ForceCostant>
<ForceMinRpmFitting>1000</ForceMinRpmFitting>
<MomentQuadraticCoefficent>2.6604e-7</MomentQuadraticCoefficent>
<MomentLinearCoefficent>-4.6797e-4</MomentLinearCoefficent>
<MomentCostant>0.2046</MomentCostant>
<MomentMinRpmFitting>1000</MomentMinRpmFitting>

...

\end{lstlisting}